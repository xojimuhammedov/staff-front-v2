import{u as X,ad as Z,r as p,l,j as c,a as t,ah as N,M as w,p as $,U as P,B as K}from"./index.e5d80a55.js";import{M as Q}from"./MyDateRangePicker.9bf8c213.js";import{M as A}from"./MySelect.c814ee28.js";import{a as ee}from"./MyDivider.9f45eeca.js";import{L as B}from"./LabelledCaption.19e76a03.js";import{u as U,K as W,U as v}from"./url.1178bcbf.js";import{u as te}from"./usePutQuery.9abfc37d.js";import{u as se}from"./useGetOneQuery.b7db22b1.js";import{u as ae,C as h}from"./index.esm.746166b2.js";import{M as g}from"./MyToggle.b7e27a1a.js";const ge=()=>{var G,z,j,L,D,F;const{t:s}=X(),{id:S}=Z(),[_,C]=p.exports.useState(!1),[q,f]=p.exports.useState(!1),[y,M]=p.exports.useState(null),[b,R]=p.exports.useState([{type:"WEBSITE",useful:[],unuseful:[]},{type:"ACTIVE_WINDOW",useful:[],unuseful:[]}]),{data:I}=U({key:W.getListOrganizationSelf,url:v.getListOrganizationSelf,params:{}}),{data:a,refetch:Y}=se({id:S,url:v.getPolicyList,params:{},enabled:!!S}),{data:E}=U({key:W.getPolicyGroups,url:v.getPolicyGroups,params:{type:y==="ACTIVE_WINDOW"?"APPLICATION":y}}),{handleSubmit:H,register:T,control:u,reset:k,formState:{errors:r}}=ae({defaultValues:p.exports.useMemo(()=>({title:l.exports.get(a,"data.title"),organizationId:l.exports.get(a,"data.organizationId"),isScreenshotEnabled:l.exports.get(a,"data.isScreenshotEnabled"),isActiveWindowEnabled:l.exports.get(a,"data.isActiveWindowEnabled"),isVisitedSitesEnabled:l.exports.get(a,"data.isVisitedSitesEnabled"),screenshotInterval:l.exports.get(a,"data.screenshotInterval"),screenshotIsGrayscale:l.exports.get(a,"data.screenshotIsGrayscale"),screenshotCaptureAll:l.exports.get(a,"data.screenshotCaptureAll")}),[a]),mode:"onChange"});p.exports.useEffect(()=>{k({title:l.exports.get(a,"data.title"),organizationId:l.exports.get(a,"data.organizationId"),isScreenshotEnabled:l.exports.get(a,"data.isScreenshotEnabled"),isActiveWindowEnabled:l.exports.get(a,"data.isActiveWindowEnabled"),isVisitedSitesEnabled:l.exports.get(a,"data.isVisitedSitesEnabled"),screenshotInterval:l.exports.get(a,"data.screenshotInterval"),screenshotIsGrayscale:l.exports.get(a,"data.screenshotIsGrayscale"),screenshotCaptureAll:l.exports.get(a,"data.screenshotCaptureAll")})},[a]);const O=(e,o,n)=>{R(i=>i.map(d=>d.type===e?{...d,[o]:n}:d))},V=(e,o)=>{const n=b.find(i=>i.type===e);return n?n[o]:[]},x=(z=(G=E==null?void 0:E.data)==null?void 0:G.map(e=>({label:e.name,value:e.id})))!=null?z:[],m=b==null?void 0:b.find(e=>e.type===y),{mutate:J}=te({listKeyId:W.getPolicyList,hideSuccessToast:!0});return c("form",{onSubmit:H(e=>{J({url:`${v.getPolicyList}/${S}`,attributes:e},{onSuccess:()=>{K.success(s("Successfully edited!")),k(),Y()},onError:o=>{var n,i,d;console.log(o),K.error((d=(i=(n=o==null?void 0:o.response)==null?void 0:n.data)==null?void 0:i.error)==null?void 0:d.message)}})}),children:[c("div",{className:"mb-12 flex w-full items-start justify-between",children:[t(B,{className:"flex-1",title:s("Group name"),subtitle:s("Short and easy-to-understand name")}),t(Q,{rootClassName:"w-[462px]",placeholder:s("Enter group name"),...T("title"),error:Boolean((j=r==null?void 0:r.title)==null?void 0:j.message),helperText:s(`${(L=r==null?void 0:r.title)==null?void 0:L.message}`)})]}),c("div",{className:"mb-12 flex w-full items-start justify-between",children:[t(B,{className:"flex-1",title:s("Organization"),subtitle:s("")}),t("div",{className:"w-[462px]",children:t(h,{name:"organizationId",control:u,render:({field:e,fieldState:o})=>t(A,{options:I==null?void 0:I.map(n=>({label:n.fullName,value:n.id})),placeholder:"Select organization",value:e.value,onChange:n=>{var i;return e.onChange(Number((i=n==null?void 0:n.value)!=null?i:n))},onBlur:e.onBlur,error:!!o.error,required:!0})})})]}),t(ee,{}),c("div",{className:"flex w-full items-start justify-between",children:[t(B,{className:"flex-1",title:s("Politics"),subtitle:s("Short and understandable caption")}),c("div",{className:"flex gap-4 flex-col w-[462px]",children:[t(h,{name:"isScreenshotEnabled",control:u,render:({field:e})=>t(g,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Screenshots of the display",iconButton:{icon:t(N,{}),onClick:()=>e.value?C(!0):{}}})}),t(h,{name:"isVisitedSitesEnabled",control:u,render:({field:e})=>t(g,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Web visiting",iconButton:{icon:t(N,{}),onClick:()=>e.value?(f(!0),M("WEBSITE")):{}}})}),t(h,{name:"isActiveWindowEnabled",control:u,render:({field:e})=>t(g,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Active Window",iconButton:{icon:t(N,{}),onClick:()=>e.value?(f(!0),M("ACTIVE_WINDOW")):{}}})})]})]}),t("div",{className:"flex justify-end mt-4",children:t(w,{type:"submit",variant:"primary",children:s("Save changes")})}),t($,{modalProps:{show:Boolean(_),onClose:()=>{C(!1)}},headerProps:{children:t("h2",{className:"text-xl font-semibold",children:s("Policy screenshot settings")}),className:"px-6"},bodyProps:{children:c(P,{children:[c("div",{className:"flex flex-col gap-4 mt-4",children:[t(Q,{...T("screenshotInterval"),error:Boolean((D=r==null?void 0:r.screenshotInterval)==null?void 0:D.message),helperText:s(`${(F=r==null?void 0:r.screenshotInterval)==null?void 0:F.message}`),placeholder:s("Enter screenshot interval")}),t(h,{name:"screenshotCaptureAll",control:u,render:({field:e})=>t(g,{checked:e.value,onChange:e.onChange,className:"w-full cursor-pointer",label:"Screenshots of the screenshotCaptureAll",iconButton:null})}),t(h,{name:"screenshotIsGrayscale",control:u,render:({field:e})=>t(g,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Screenshots of the screenshotIsGrayscale",iconButton:null})})]}),t("div",{className:"mt-2 flex w-full justify-end gap-4 pb-2",children:t(w,{onClick:()=>{C(!1)},variant:"primary",children:s("Done")})})]})}}),t($,{modalProps:{show:Boolean(q),onClose:()=>{f(!1)}},headerProps:{children:t("h2",{className:"text-xl font-semibold",children:s(y==="WEBSITE"?"Policy web visiting":"Policy web application")}),className:"px-6"},bodyProps:{children:c(P,{children:[t("div",{className:"flex flex-col gap-4 mt-4",children:m&&c(P,{children:[t(A,{label:s("Foydali saytlar"),isMulti:!0,options:x,value:x.filter(e=>V(m.type,"useful").includes(e.value)),onChange:e=>O(m.type,"useful",e.map(o=>o.value))}),t(A,{label:s("Foydasiz saytlar"),isMulti:!0,options:x,value:x.filter(e=>V(m.type,"unuseful").includes(e.value)),onChange:e=>O(m.type,"unuseful",e.map(o=>o.value))})]})}),t("div",{className:"mt-2 flex w-full justify-end gap-4 pb-2",children:t(w,{onClick:()=>{f(!1)},variant:"primary",children:s("Done")})})]})}})]})};export{ge as default};
