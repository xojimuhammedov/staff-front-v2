import{u as Z,a7 as ee,r as g,a as s,U as b,j as r,ah as N,M as w,p as D,B as z}from"./index.e5d80a55.js";import{M as G}from"./MyDateRangePicker.9bf8c213.js";import{M as I}from"./MySelect.c814ee28.js";import{a as $}from"./MyDivider.9f45eeca.js";import{L as v}from"./LabelledCaption.19e76a03.js";import{u as F,K as E,U as P}from"./url.1178bcbf.js";import{u as se}from"./usePostQuery.56c363fc.js";import{c as ae,a as R,b as K,o as te}from"./index.esm.649fd59a.js";import{u as le,C as u}from"./index.esm.746166b2.js";import{M as p}from"./MyToggle.b7e27a1a.js";const ye=()=>{var k,A,O,j,L;const{t}=Z(),U=ee(),[_,x]=g.exports.useState(!1),[q,h]=g.exports.useState(!1),[d,Q]=g.exports.useState([{type:"WEBSITE",useful:[],unuseful:[]},{type:"ACTIVE_WINDOW",useful:[],unuseful:[]}]),B=(e,o,a)=>{Q(n=>n.map(c=>c.type===e?{...c,[o]:a}:c))},[f,T]=g.exports.useState(null),{data:C}=F({key:E.getPolicyGroups,url:P.getPolicyGroups,params:{type:f==="ACTIVE_WINDOW"?"APPLICATION":f}}),Y=ae().shape({title:R().required(),description:R(),organizationId:K(),screenshotInterval:K()}),{handleSubmit:H,register:M,control:i,formState:{errors:l}}=le({defaultValues:{isScreenshotEnabled:!1,isActiveWindowEnabled:!1,isVisitedSitesEnabled:!1,screenshotInterval:60,screenshotIsGrayscale:!1,screenshotCaptureAll:!1},mode:"onChange",resolver:te(Y)}),{data:S}=F({key:E.getListOrganizationSelf,url:P.getListOrganizationSelf,params:{}}),{mutate:J,isLoading:ne}=se({listKeyId:E.getPolicyList,hideSuccessToast:!0}),X=e=>{const o={options:d,...e};J({url:P.getPolicyList,attributes:o},{onSuccess:a=>{var n;console.log(a),U(`/policy/create?current-step=1&current-rule=employee-groups&policyId=${(n=a==null?void 0:a.data)==null?void 0:n.id}`),z.success(t("Successfully created!"))},onError:a=>{var n,c,V;console.log(a),z.error(((V=(c=(n=a==null?void 0:a.response)==null?void 0:n.data)==null?void 0:c.error)==null?void 0:V.message)||"ERROR")}})},W=(e,o)=>{const a=d.find(n=>n.type===e);return a?a[o]:[]},y=((k=C==null?void 0:C.data)==null?void 0:k.map(e=>({label:e.name,value:e.id})))||[],m=d==null?void 0:d.find(e=>e.type===f);return s(b,{children:r("form",{onSubmit:H(X),children:[s(v,{title:t("Schedule details"),subtitle:t("Edit module name and description")}),s($,{className:"mb-3xl"}),r("div",{className:"mb-12 flex w-full items-start justify-between",children:[s(v,{className:"flex-1",title:t("Group name"),subtitle:t("Short and easy-to-understand name")}),s(G,{...M("title"),error:Boolean((A=l==null?void 0:l.title)==null?void 0:A.message),helperText:t(`${(O=l==null?void 0:l.title)==null?void 0:O.message}`),rootClassName:"max-w-[462px]",placeholder:t("Enter group name")})]}),r("div",{className:"mb-12 flex w-full items-start justify-between",children:[s(v,{className:"flex-1",title:t("Organization"),subtitle:t("")}),s("div",{className:"w-[462px]",children:s(u,{name:"organizationId",control:i,render:({field:e,fieldState:o})=>s(I,{options:S==null?void 0:S.map(a=>({label:a.fullName,value:a.id})),placeholder:"Select organization",value:e.value,onChange:a=>{var n;return e.onChange(Number((n=a==null?void 0:a.value)!=null?n:a))},onBlur:e.onBlur,error:!!o.error,required:!0})})})]}),s($,{}),r("div",{className:"flex w-full items-start justify-between",children:[s(v,{className:"flex-1",title:t("Politics"),subtitle:t("Short and understandable caption")}),r("div",{className:"flex gap-4 flex-col w-[462px]",children:[s(u,{name:"isScreenshotEnabled",control:i,render:({field:e})=>s(p,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Screenshots of the display",iconButton:{icon:s(N,{}),onClick:()=>e.value?x(!0):{}}})}),s(u,{name:"isVisitedSitesEnabled",control:i,render:({field:e})=>s(p,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Web visiting",iconButton:{icon:s(N,{}),onClick:()=>e.value?(h(!0),T("WEBSITE")):{}}})}),s(u,{name:"isActiveWindowEnabled",control:i,render:({field:e})=>s(p,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Active Window",iconButton:{icon:s(N,{}),onClick:()=>e.value?(h(!0),T("ACTIVE_WINDOW")):{}}})})]})]}),s("div",{className:"flex justify-end mt-4",children:s(w,{type:"submit",variant:"primary",children:t("Create")})}),s(D,{modalProps:{show:Boolean(_),onClose:()=>{x(!1)}},headerProps:{children:s("h2",{className:"text-xl font-semibold",children:t("Policy screenshot settings")}),className:"px-6"},bodyProps:{children:r(b,{children:[r("div",{className:"flex flex-col gap-4 mt-4",children:[s(G,{...M("screenshotInterval"),error:Boolean((j=l==null?void 0:l.screenshotInterval)==null?void 0:j.message),helperText:t(`${(L=l==null?void 0:l.screenshotInterval)==null?void 0:L.message}`),placeholder:t("Enter screenshot interval")}),s(u,{name:"screenshotCaptureAll",control:i,render:({field:e})=>s(p,{checked:e.value,onChange:e.onChange,className:"w-full cursor-pointer",label:"Screenshots of the screenshotCaptureAll",iconButton:null})}),s(u,{name:"screenshotIsGrayscale",control:i,render:({field:e})=>s(p,{checked:e.value,onChange:e.onChange,className:"w-full",label:"Screenshots of the screenshotIsGrayscale",iconButton:null})})]}),s("div",{className:"mt-2 flex w-full justify-end gap-4 pb-2",children:s(w,{onClick:()=>{x(!1)},variant:"primary",children:t("Done")})})]})}}),s(D,{modalProps:{show:Boolean(q),onClose:()=>{h(!1)}},headerProps:{children:s("h2",{className:"text-xl font-semibold",children:t(f==="WEBSITE"?"Policy web visiting":"Policy web application")}),className:"px-6"},bodyProps:{children:r(b,{children:[s("div",{className:"flex flex-col gap-4 mt-4",children:m&&r(b,{children:[s(I,{label:t("Foydali saytlar"),isMulti:!0,options:y,value:y.filter(e=>W(m.type,"useful").includes(e.value)),onChange:e=>B(m.type,"useful",e.map(o=>o.value))}),s(I,{label:t("Foydasiz saytlar"),isMulti:!0,options:y,value:y.filter(e=>W(m.type,"unuseful").includes(e.value)),onChange:e=>B(m.type,"unuseful",e.map(o=>o.value))})]})}),s("div",{className:"mt-2 flex w-full justify-end gap-4 pb-2",children:s(w,{onClick:()=>{h(!1)},variant:"primary",children:t("Done")})})]})}})]})})};export{ye as default};
